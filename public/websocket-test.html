<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket è¿æ¥æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .status {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-disconnected {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }

        .status-connecting {
            background: #fff3e0;
            color: #e65100;
            border: 1px solid #ffcc80;
        }

        .status-connected {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-disconnected .status-icon {
            background: #c62828;
        }

        .status-connecting .status-icon {
            background: #e65100;
        }

        .status-connected .status-icon {
            background: #2e7d32;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .log-time {
            color: #858585;
            margin-right: 8px;
        }

        .log-info {
            color: #4fc3f7;
        }

        .log-success {
            color: #66bb6a;
        }

        .log-error {
            color: #ef5350;
        }

        .log-warning {
            color: #ffa726;
        }

        .message-input {
            margin-bottom: 15px;
        }

        .message-input textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            min-height: 100px;
        }

        .message-input textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .quick-messages {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .quick-message-btn {
            padding: 8px 16px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-message-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 12px;
            border-top: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”Œ WebSocket è¿æ¥æµ‹è¯•</h1>
            <p>æµ‹è¯•äº‘æ‰˜ç®¡ç¯å¢ƒçš„ WebSocket è¿æ¥</p>
        </div>

        <div class="content">
            <!-- è¿æ¥é…ç½® -->
            <div class="section">
                <div class="section-title">è¿æ¥é…ç½®</div>
                
                <div class="input-group">
                    <label>é€‰æ‹©æµ‹è¯•åœ°å€</label>
                    <select id="urlSelect">
                        <option value="wss://api.yimengpl.com/test-ws">è‡ªå®šä¹‰åŸŸå - wss://api.yimengpl.com/test-ws</option>
                        <option value="wss://jlzr1101-5g9kplxza13a780d-1302271970.ap-shanghai.app.tcloudbase.com/test-ws">é»˜è®¤åŸŸå (ap-shanghai)</option>
                        <option value="wss://jlzr1101-5g9kplxza13a780d-1302271970.tcloudbaseapp.com/test-ws">é»˜è®¤åŸŸå (tcloudbaseapp)</option>
                        <option value="custom">è‡ªå®šä¹‰åœ°å€...</option>
                    </select>
                </div>

                <div class="input-group" id="customUrlGroup" style="display: none;">
                    <label>è‡ªå®šä¹‰ WebSocket åœ°å€</label>
                    <input type="text" id="customUrl" placeholder="wss://your-domain.com/path">
                </div>

                <div id="statusDisplay" class="status status-disconnected">
                    <div class="status-icon"></div>
                    <span>æœªè¿æ¥</span>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="connectBtn">è¿æ¥</button>
                    <button class="btn btn-danger" id="disconnectBtn" disabled>æ–­å¼€</button>
                    <button class="btn btn-secondary" id="clearLogBtn">æ¸…ç©ºæ—¥å¿—</button>
                </div>
            </div>

            <!-- æ¶ˆæ¯å‘é€ -->
            <div class="section">
                <div class="section-title">å‘é€æ¶ˆæ¯</div>
                
                <div class="quick-messages">
                    <button class="quick-message-btn" data-message='{"type":"ping"}'>Ping</button>
                    <button class="quick-message-btn" data-message='{"type":"test","message":"æµ‹è¯•æ¶ˆæ¯"}'>æµ‹è¯•æ¶ˆæ¯</button>
                    <button class="quick-message-btn" data-message='{"type":"echo","data":"Hello WebSocket"}'>Echo</button>
                    <button class="quick-message-btn" data-message='{"type":"info"}'>è·å–ä¿¡æ¯</button>
                </div>

                <div class="message-input">
                    <textarea id="messageInput" placeholder='è¾“å…¥ JSON æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼š{"type":"ping","message":"æµ‹è¯•"}'></textarea>
                </div>

                <button class="btn btn-primary" id="sendBtn" disabled>å‘é€æ¶ˆæ¯</button>
            </div>

            <!-- æ—¥å¿—è¾“å‡º -->
            <div class="section">
                <div class="section-title">è¿æ¥æ—¥å¿—</div>
                <div class="log-container" id="logContainer">
                    <div class="log-entry log-info">
                        <span class="log-time">[ç³»ç»Ÿ]</span>
                        <span>å‡†å¤‡å°±ç»ªï¼Œè¯·ç‚¹å‡»"è¿æ¥"æŒ‰é’®å¼€å§‹æµ‹è¯•</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            WebSocket æµ‹è¯•å·¥å…· v1.0 | äº‘æ‰˜ç®¡ç¯å¢ƒï¼šjlzr1101-5g9kplxza13a780d
        </div>
    </div>

    <script>
        let ws = null;
        let isConnected = false;

        const urlSelect = document.getElementById('urlSelect');
        const customUrlGroup = document.getElementById('customUrlGroup');
        const customUrl = document.getElementById('customUrl');
        const statusDisplay = document.getElementById('statusDisplay');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const clearLogBtn = document.getElementById('clearLogBtn');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const logContainer = document.getElementById('logContainer');

        // URL é€‰æ‹©å˜åŒ–
        urlSelect.addEventListener('change', () => {
            if (urlSelect.value === 'custom') {
                customUrlGroup.style.display = 'block';
            } else {
                customUrlGroup.style.display = 'none';
            }
        });

        // è¿æ¥æŒ‰é’®
        connectBtn.addEventListener('click', () => {
            const url = urlSelect.value === 'custom' ? customUrl.value : urlSelect.value;
            if (!url) {
                addLog('error', 'è¯·è¾“å…¥ WebSocket åœ°å€');
                return;
            }
            connect(url);
        });

        // æ–­å¼€æŒ‰é’®
        disconnectBtn.addEventListener('click', () => {
            disconnect();
        });

        // æ¸…ç©ºæ—¥å¿—
        clearLogBtn.addEventListener('click', () => {
            logContainer.innerHTML = '';
            addLog('info', 'æ—¥å¿—å·²æ¸…ç©º');
        });

        // å‘é€æ¶ˆæ¯
        sendBtn.addEventListener('click', () => {
            sendMessage();
        });

        // å¿«æ·æ¶ˆæ¯æŒ‰é’®
        document.querySelectorAll('.quick-message-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const message = btn.getAttribute('data-message');
                messageInput.value = message;
                if (isConnected) {
                    sendMessage();
                }
            });
        });

        // è¿æ¥ WebSocket
        function connect(url) {
            addLog('info', `æ­£åœ¨è¿æ¥: ${url}`);
            updateStatus('connecting', 'è¿æ¥ä¸­...');
            connectBtn.disabled = true;

            try {
                ws = new WebSocket(url);

                ws.onopen = () => {
                    isConnected = true;
                    addLog('success', 'âœ… WebSocket è¿æ¥æˆåŠŸ!');
                    updateStatus('connected', 'å·²è¿æ¥');
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;
                    sendBtn.disabled = false;
                };

                ws.onmessage = (event) => {
                    addLog('success', `ğŸ“¥ æ”¶åˆ°æ¶ˆæ¯: ${event.data}`);
                    try {
                        const data = JSON.parse(event.data);
                        addLog('info', `ğŸ“‹ è§£æå: ${JSON.stringify(data, null, 2)}`);
                    } catch (e) {
                        addLog('warning', 'âš ï¸ æ— æ³•è§£æä¸º JSON');
                    }
                };

                ws.onerror = (error) => {
                    addLog('error', `âŒ è¿æ¥é”™è¯¯: ${error.message || 'æœªçŸ¥é”™è¯¯'}`);
                    updateStatus('disconnected', 'è¿æ¥å¤±è´¥');
                };

                ws.onclose = (event) => {
                    isConnected = false;
                    addLog('warning', `ğŸ”Œ è¿æ¥å·²å…³é—­ (ä»£ç : ${event.code}, åŸå› : ${event.reason || 'æ— '})`);
                    updateStatus('disconnected', 'æœªè¿æ¥');
                    connectBtn.disabled = false;
                    disconnectBtn.disabled = true;
                    sendBtn.disabled = true;
                };

            } catch (error) {
                addLog('error', `âŒ åˆ›å»ºè¿æ¥å¤±è´¥: ${error.message}`);
                updateStatus('disconnected', 'è¿æ¥å¤±è´¥');
                connectBtn.disabled = false;
            }
        }

        // æ–­å¼€è¿æ¥
        function disconnect() {
            if (ws) {
                addLog('info', 'æ­£åœ¨æ–­å¼€è¿æ¥...');
                ws.close();
                ws = null;
            }
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            if (!isConnected || !ws) {
                addLog('error', 'âŒ æœªè¿æ¥åˆ° WebSocket');
                return;
            }

            const message = messageInput.value.trim();
            if (!message) {
                addLog('error', 'âŒ æ¶ˆæ¯ä¸èƒ½ä¸ºç©º');
                return;
            }

            try {
                // éªŒè¯ JSON æ ¼å¼
                JSON.parse(message);
                ws.send(message);
                addLog('info', `ğŸ“¤ å‘é€æ¶ˆæ¯: ${message}`);
            } catch (e) {
                addLog('error', `âŒ æ— æ•ˆçš„ JSON æ ¼å¼: ${e.message}`);
            }
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(status, text) {
            statusDisplay.className = `status status-${status}`;
            statusDisplay.innerHTML = `
                <div class="status-icon"></div>
                <span>${text}</span>
            `;
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(type, message) {
            const time = new Date().toLocaleTimeString('zh-CN');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span>${message}</span>
            `;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // å›è½¦å‘é€
        messageInput.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>

