# Socket.IO äº‘æ‰˜ç®¡æ–¹æ¡ˆå®æ–½å®Œæˆ âœ…

## ğŸ“‹ å®æ–½æ¦‚è§ˆ

æ ¹æ® [è¿™ç¯‡åšå®¢æ–‡ç« ](https://blog.csdn.net/z329600208z/article/details/153698728) çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†åŸºäº `wx.cloud.connectContainer` çš„ Socket.IO è¿æ¥æ–¹æ¡ˆï¼Œ**æ— éœ€å¤‡æ¡ˆåŸŸå**å³å¯åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨ Socket.IOã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯æ”¹é€  âœ…

#### ğŸ“¦ å®‰è£…ä¾èµ–
- âœ… å®‰è£…äº† `socket.io` åŒ…

#### âš™ï¸ é…ç½® Socket.IO æœåŠ¡å™¨
- âœ… ä¿®æ”¹ `bin/www` åˆå§‹åŒ– Socket.IO æœåŠ¡å™¨
- âœ… é…ç½® CORS å’Œä¼ è¾“æ–¹å¼
- âœ… å°† io å®ä¾‹æŒ‚è½½åˆ° app

#### ğŸ›£ï¸ åˆ›å»º Socket.IO è·¯ç”±
- âœ… åˆ›å»º `routes/realtime-voice-socketio.js`
- âœ… å®ç°å‘½åç©ºé—´è¿æ¥å¤„ç†
- âœ… å®ç°äº‹ä»¶ç›‘å¬ï¼ˆstart, audio, stopï¼‰
- âœ… å®ç° Token è®¤è¯
- âœ… ä¿ç•™åŸæœ‰çš„ HTTP APIï¼ˆhistory, stats, recognizeï¼‰

#### ğŸ”— æ³¨å†Œè·¯ç”±
- âœ… åœ¨ `app.js` ä¸­æ³¨å†Œ Socket.IO è·¯ç”±
- âœ… åœ¨ `bin/www` ä¸­è°ƒç”¨åˆå§‹åŒ–å‡½æ•°

### 2. å‰ç«¯å®ç° âœ…

#### ğŸ“± Socket.IO å®¢æˆ·ç«¯ç±»
- âœ… åˆ›å»º `miniapp-example/utils/cloudbase-socketio-client.js`
- âœ… æ‰‹åŠ¨å®ç° Engine.IO åè®®ï¼ˆOPEN, PING, PONG, MESSAGE ç­‰ï¼‰
- âœ… æ‰‹åŠ¨å®ç° Socket.IO åè®®ï¼ˆCONNECT, EVENT, DISCONNECT ç­‰ï¼‰
- âœ… å®ç°è‡ªåŠ¨å¿ƒè·³ä¿æ´»
- âœ… å®ç°æ–­çº¿è‡ªåŠ¨é‡è¿
- âœ… æä¾›äº‹ä»¶è®¢é˜…å’Œå‘å¸ƒæ¥å£

#### ğŸ–¼ï¸ ç¤ºä¾‹é¡µé¢
- âœ… åˆ›å»º `miniapp-example/pages/realtime-voice-cloudbase/`
- âœ… å®ç°å®Œæ•´çš„å®æ—¶è¯­éŸ³è¯†åˆ«ç•Œé¢
- âœ… å®ç°å½•éŸ³æ§åˆ¶
- âœ… å®ç°è¿æ¥çŠ¶æ€æ˜¾ç¤º
- âœ… å®ç°å†å²è®°å½•æŸ¥çœ‹
- âœ… å®ç°ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º

### 3. æ–‡æ¡£ç¼–å†™ âœ…

- âœ… åˆ›å»ºè¯¦ç»†çš„é›†æˆæŒ‡å— `docs/Socket.IOäº‘æ‰˜ç®¡é›†æˆæŒ‡å—.md`
- âœ… åˆ›å»ºå¿«é€Ÿå¼€å§‹æ–‡æ¡£ `README-Socket.IOäº‘æ‰˜ç®¡.md`
- âœ… åŒ…å«å®Œæ•´çš„ API å‚è€ƒ
- âœ… åŒ…å«å¸¸è§é—®é¢˜è§£ç­”
- âœ… åŒ…å«åè®®è¯´æ˜å’Œæ¶æ„å›¾

## ğŸ“ æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶

```
bin/www                                    # âœ… å·²ä¿®æ”¹ - åˆå§‹åŒ– Socket.IO
app.js                                     # âœ… å·²ä¿®æ”¹ - æ³¨å†Œ Socket.IO è·¯ç”±
routes/realtime-voice-socketio.js          # âœ… æ–°å¢ - Socket.IO è·¯ç”±å¤„ç†
```

### å‰ç«¯æ–‡ä»¶

```
miniapp-example/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ cloudbase-socketio-client.js       # âœ… æ–°å¢ - Socket.IO å®¢æˆ·ç«¯ç±»
â””â”€â”€ pages/
    â””â”€â”€ realtime-voice-cloudbase/          # âœ… æ–°å¢ - ç¤ºä¾‹é¡µé¢
        â”œâ”€â”€ realtime-voice-cloudbase.js
        â”œâ”€â”€ realtime-voice-cloudbase.wxml
        â”œâ”€â”€ realtime-voice-cloudbase.wxss
        â””â”€â”€ realtime-voice-cloudbase.json
```

### æ–‡æ¡£æ–‡ä»¶

```
docs/Socket.IOäº‘æ‰˜ç®¡é›†æˆæŒ‡å—.md           # âœ… æ–°å¢ - è¯¦ç»†æ–‡æ¡£
README-Socket.IOäº‘æ‰˜ç®¡.md                 # âœ… æ–°å¢ - å¿«é€Ÿå¼€å§‹
Socket.IOäº‘æ‰˜ç®¡å®æ–½å®Œæˆ.md                # âœ… æœ¬æ–‡ä»¶
```

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. éƒ¨ç½²åç«¯åˆ°å¾®ä¿¡äº‘æ‰˜ç®¡

```bash
# 1. ç¡®ä¿ package.json ä¸­åŒ…å« socket.io
npm install

# 2. æ„å»º Docker é•œåƒï¼ˆå¦‚æœä½¿ç”¨ Dockerfileï¼‰
docker build -t your-image-name .

# 3. æ¨é€åˆ°äº‘æ‰˜ç®¡
# æŒ‰ç…§å¾®ä¿¡äº‘æ‰˜ç®¡æ–‡æ¡£è¿›è¡Œéƒ¨ç½²
```

### 2. é…ç½®å°ç¨‹åº

#### 2.1 å¤åˆ¶æ–‡ä»¶åˆ°å°ç¨‹åºé¡¹ç›®

```bash
# å¤åˆ¶ Socket.IO å®¢æˆ·ç«¯ç±»
cp miniapp-example/utils/cloudbase-socketio-client.js <ä½ çš„å°ç¨‹åº>/utils/

# å¯é€‰ï¼šå¤åˆ¶ç¤ºä¾‹é¡µé¢
cp -r miniapp-example/pages/realtime-voice-cloudbase <ä½ çš„å°ç¨‹åº>/pages/
```

#### 2.2 åˆå§‹åŒ–äº‘å¼€å‘

åœ¨å°ç¨‹åºçš„ `app.js` ä¸­ï¼š

```javascript
App({
  onLaunch() {
    // åˆå§‹åŒ–äº‘å¼€å‘
    wx.cloud.init({
      traceUser: true
    })
  }
})
```

#### 2.3 é…ç½®æœåŠ¡åç§°

åœ¨é¡µé¢ä»£ç ä¸­ï¼Œå°† `service` å‚æ•°æ›¿æ¢ä¸ºä½ çš„äº‘æ‰˜ç®¡æœåŠ¡åç§°ï¼š

```javascript
// miniapp-example/pages/realtime-voice-cloudbase/realtime-voice-cloudbase.js
data: {
  service: 'your-actual-service-name' // âš ï¸ æ›¿æ¢è¿™é‡Œ
}
```

ä½ å¯ä»¥åœ¨è…¾è®¯äº‘æ§åˆ¶å°çš„ã€Œäº‘æ‰˜ç®¡ã€â†’ã€ŒæœåŠ¡åˆ—è¡¨ã€ä¸­æ‰¾åˆ°æœåŠ¡åç§°ã€‚

### 3. æµ‹è¯•è¿æ¥

#### 3.1 å¯åŠ¨æœ¬åœ°åç«¯ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

```bash
npm start
# æˆ–
npm run dev
```

#### 3.2 åœ¨å°ç¨‹åºå¼€å‘å·¥å…·ä¸­æµ‹è¯•

âš ï¸ **æ³¨æ„**ï¼šå¾®ä¿¡å¼€å‘å·¥å…·å¯¹äº‘æ‰˜ç®¡å®¹å™¨è¿æ¥çš„æ”¯æŒæœ‰é™ï¼Œå»ºè®®åœ¨çœŸæœºä¸Šæµ‹è¯•ã€‚

#### 3.3 çœŸæœºæµ‹è¯•

1. åœ¨å¾®ä¿¡å¼€å‘å·¥å…·ä¸­ç‚¹å‡»ã€Œé¢„è§ˆã€ç”ŸæˆäºŒç»´ç 
2. ä½¿ç”¨æ‰‹æœºå¾®ä¿¡æ‰«ç 
3. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤è¿æ¥æˆåŠŸ

é¢„æœŸçœ‹åˆ°çš„æ—¥å¿—ï¼š

```
äº‘æ‰˜ç®¡å®¹å™¨ WebSocket è¿æ¥æˆåŠŸ
WebSocket è¿æ¥å·²å»ºç«‹ï¼Œå‘é€ Socket.IO CONNECT åŒ… (40)
æ”¶åˆ° Engine.IO OPEN åŒ…
Socket.IO è¿æ¥æˆåŠŸ
```

## ğŸ” è°ƒè¯•æŒ‡å—

### å¼€å¯è°ƒè¯•æ—¥å¿—

åœ¨åˆ›å»ºå®¢æˆ·ç«¯æ—¶è®¾ç½® `debug: true`ï¼š

```javascript
const client = new CloudBaseSocketIOClient({
  service: 'your-service-name',
  namespace: '/realtime-voice',
  debug: true // â† å¼€å¯è°ƒè¯•
})
```

è¿™ä¼šè¾“å‡ºè¯¦ç»†çš„åè®®äº¤äº’æ—¥å¿—ï¼Œå¸®åŠ©ä½ æ’æŸ¥é—®é¢˜ã€‚

### å¸¸è§é—®é¢˜æ’æŸ¥

#### é—®é¢˜ 1ï¼šè¿æ¥å¤±è´¥

```
é”™è¯¯ï¼šè¿æ¥äº‘æ‰˜ç®¡å®¹å™¨å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æ˜¯å¦åˆå§‹åŒ–äº†äº‘å¼€å‘ï¼ˆ`wx.cloud.init()`ï¼‰
2. æ£€æŸ¥ `service` å‚æ•°æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤å°ç¨‹åºå·²å¼€å¯äº‘å¼€å‘èƒ½åŠ›
4. åœ¨çœŸæœºä¸Šæµ‹è¯•ï¼ˆå¼€å‘å·¥å…·å¯èƒ½ä¸æ”¯æŒï¼‰

#### é—®é¢˜ 2ï¼šè¿æ¥æˆåŠŸä½†æ”¶ä¸åˆ°æ¶ˆæ¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥å‘½åç©ºé—´æ˜¯å¦åŒ¹é…ï¼ˆå‰ç«¯ `/realtime-voice` vs åç«¯ `io.of('/realtime-voice')`ï¼‰
2. æ£€æŸ¥äº‹ä»¶åç§°æ˜¯å¦ä¸€è‡´
3. å¼€å¯ `debug: true` æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
4. æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®å‘é€äº†äº‹ä»¶

#### é—®é¢˜ 3ï¼šé¢‘ç¹æ–­å¼€é‡è¿

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç½‘ç»œçŠ¶æ€
2. æ£€æŸ¥åç«¯å¿ƒè·³é…ç½®
3. æ£€æŸ¥æœåŠ¡å™¨èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰

### æŸ¥çœ‹åç«¯æ—¥å¿—

åœ¨äº‘æ‰˜ç®¡æ§åˆ¶å°æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š

```
è…¾è®¯äº‘æ§åˆ¶å° â†’ äº‘æ‰˜ç®¡ â†’ æœåŠ¡åˆ—è¡¨ â†’ ä½ çš„æœåŠ¡ â†’ æ—¥å¿—
```

é¢„æœŸçœ‹åˆ°çš„æ—¥å¿—ï¼š

```
Socket.IO æœåŠ¡å™¨å·²åˆå§‹åŒ–
æ­£åœ¨åˆå§‹åŒ– Socket.IO å®æ—¶è¯­éŸ³è¯†åˆ«æœåŠ¡...
Socket.IO å®æ—¶è¯­éŸ³è¯†åˆ«æœåŠ¡åˆå§‹åŒ–å®Œæˆ
Socket.IO å®¢æˆ·ç«¯å·²è¿æ¥: xxxxx
```

## ğŸ“š ä½¿ç”¨æ–‡æ¡£

è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜è¯·æŸ¥çœ‹ï¼š

1. **å¿«é€Ÿå¼€å§‹**ï¼š[README-Socket.IOäº‘æ‰˜ç®¡.md](README-Socket.IOäº‘æ‰˜ç®¡.md)
2. **å®Œæ•´æ–‡æ¡£**ï¼š[docs/Socket.IOäº‘æ‰˜ç®¡é›†æˆæŒ‡å—.md](docs/Socket.IOäº‘æ‰˜ç®¡é›†æˆæŒ‡å—.md)

æ–‡æ¡£åŒ…å«ï¼š
- âœ… åè®®è¯¦è§£
- âœ… æ¶æ„è¯´æ˜
- âœ… å®Œæ•´çš„ API å‚è€ƒ
- âœ… ä½¿ç”¨ç¤ºä¾‹
- âœ… å¸¸è§é—®é¢˜è§£ç­”
- âœ… å‚è€ƒèµ„æ–™

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

ä¸ä¼ ç»Ÿ WebSocket æ–¹æ¡ˆå¯¹æ¯”ï¼š

| ç‰¹æ€§ | ä¼ ç»Ÿ WebSocket | Socket.IO äº‘æ‰˜ç®¡æ–¹æ¡ˆ |
|------|---------------|-------------------|
| æ˜¯å¦éœ€è¦å¤‡æ¡ˆåŸŸå | âœ… å¿…éœ€ | âŒ ä¸éœ€è¦ |
| è¿æ¥æ–¹å¼ | `wx.connectSocket` | `wx.cloud.connectContainer` |
| åè®®æ”¯æŒ | åŸç”Ÿ WebSocket | Socket.IO + Engine.IO |
| è‡ªåŠ¨é‡è¿ | éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½® |
| å¿ƒè·³ä¿æ´» | éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½® |
| äº‹ä»¶æœºåˆ¶ | éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½® |

## ğŸ“Š æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¾®ä¿¡å°ç¨‹åº    â”‚                                  â”‚  è…¾è®¯äº‘æ‰˜ç®¡å®¹å™¨  â”‚
â”‚                 â”‚                                  â”‚                 â”‚
â”‚  CloudBase      â”‚  wx.cloud.connectContainer      â”‚   Socket.IO     â”‚
â”‚  SocketIO       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Server        â”‚
â”‚  Client         â”‚                                  â”‚                 â”‚
â”‚                 â”‚  æ‰‹åŠ¨å®ç° Socket.IO åè®®         â”‚                 â”‚
â”‚  - Engine.IO    â”‚                                  â”‚  - Engine.IO    â”‚
â”‚  - Socket.IO    â”‚                                  â”‚  - Socket.IO    â”‚
â”‚  - å¿ƒè·³ä¿æ´»     â”‚                                  â”‚  - å‘½åç©ºé—´     â”‚
â”‚  - è‡ªåŠ¨é‡è¿     â”‚                                  â”‚  - æˆ¿é—´ç®¡ç†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ‰ åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°çš„åŠŸèƒ½

- âœ… Engine.IO åè®®æ”¯æŒï¼ˆOPEN, PING, PONG, MESSAGE, CLOSEï¼‰
- âœ… Socket.IO åè®®æ”¯æŒï¼ˆCONNECT, EVENT, DISCONNECT, ACKï¼‰
- âœ… å‘½åç©ºé—´æ”¯æŒ
- âœ… è‡ªå®šä¹‰äº‹ä»¶å‘é€å’Œæ¥æ”¶
- âœ… è‡ªåŠ¨å¿ƒè·³ä¿æ´»
- âœ… æ–­çº¿è‡ªåŠ¨é‡è¿
- âœ… è¿æ¥çŠ¶æ€ç®¡ç†
- âœ… Token è®¤è¯
- âœ… é”™è¯¯å¤„ç†

### ç¤ºä¾‹åº”ç”¨åŠŸèƒ½

- âœ… å®æ—¶è¯­éŸ³è¯†åˆ«ï¼ˆæµå¼ä¼ è¾“ï¼‰
- âœ… å½•éŸ³æ§åˆ¶
- âœ… è¿æ¥çŠ¶æ€æ˜¾ç¤º
- âœ… è¯†åˆ«ç»“æœå®æ—¶æ˜¾ç¤º
- âœ… å†å²è®°å½•ç®¡ç†
- âœ… ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º

## ğŸ“ ä»£ç ç¤ºä¾‹

### æœ€ç®€å•çš„ä½¿ç”¨ç¤ºä¾‹

```javascript
// 1. å¼•å…¥å®¢æˆ·ç«¯ç±»
const CloudBaseSocketIOClient = require('../../utils/cloudbase-socketio-client')

// 2. åˆ›å»ºå®ä¾‹
const client = new CloudBaseSocketIOClient({
  service: 'your-service-name',
  namespace: '/realtime-voice',
  debug: true
})

// 3. ç›‘å¬è¿æ¥
client.onInternal('connect', () => {
  console.log('å·²è¿æ¥')
  // å‘é€äº‹ä»¶
  client.emit('start', { token: 'xxx' })
})

// 4. ç›‘å¬æœåŠ¡å™¨äº‹ä»¶
client.on('result', (data) => {
  console.log('æ”¶åˆ°ç»“æœ:', data)
})

// 5. è¿æ¥
await client.connect()
```

## ğŸ”— å‚è€ƒèµ„æ–™

1. [åŸæ–‡åšå®¢](https://blog.csdn.net/z329600208z/article/details/153698728) - çµæ„Ÿæ¥æº
2. [Socket.IO å®˜æ–¹æ–‡æ¡£](https://socket.io/docs/v4/)
3. [Engine.IO åè®®](https://socket.io/docs/v4/engine-io-protocol/)
4. [å¾®ä¿¡äº‘æ‰˜ç®¡æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/container/)
5. [wx.cloud.connectContainer API](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/utils/Cloud.connectContainer.html)

## ğŸ’¡ æ³¨æ„äº‹é¡¹

1. âš ï¸ å¿…é¡»åœ¨çœŸæœºä¸Šæµ‹è¯•ï¼Œå¼€å‘å·¥å…·æ”¯æŒæœ‰é™
2. âš ï¸ å¿…é¡»æ­£ç¡®é…ç½®äº‘æ‰˜ç®¡æœåŠ¡åç§°
3. âš ï¸ åç«¯å‘½åç©ºé—´å¿…é¡»ä¸å‰ç«¯åŒ¹é…
4. âš ï¸ å»ºè®®å¼€å¯ debug æ¨¡å¼è¿›è¡Œè°ƒè¯•
5. âš ï¸ éœ€è¦åœ¨å°ç¨‹åºä¸­åˆå§‹åŒ–äº‘å¼€å‘

## ğŸŠ æ€»ç»“

æˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†åŸºäºå¾®ä¿¡äº‘æ‰˜ç®¡çš„ Socket.IO æ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒä¼˜åŠ¿æ˜¯ï¼š

1. **æ— éœ€å¤‡æ¡ˆåŸŸå** - ä½¿ç”¨äº‘æ‰˜ç®¡å®¹å™¨è¿æ¥
2. **å®Œæ•´çš„ Socket.IO æ”¯æŒ** - æ‰‹åŠ¨å®ç°äº†å®Œæ•´çš„åè®®
3. **å¼€ç®±å³ç”¨** - æä¾›äº†å®Œæ•´çš„ç¤ºä¾‹ä»£ç 
4. **ç”Ÿäº§å¯ç”¨** - åŒ…å«é”™è¯¯å¤„ç†ã€é‡è¿ã€å¿ƒè·³ç­‰æœºåˆ¶

ç°åœ¨ä½ å¯ä»¥ï¼š
1. éƒ¨ç½²åç«¯åˆ°äº‘æ‰˜ç®¡
2. åœ¨å°ç¨‹åºä¸­é›†æˆå®¢æˆ·ç«¯
3. å¼€å§‹ä½¿ç”¨ Socket.IO è¿›è¡Œå®æ—¶é€šä¿¡

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. [å®Œæ•´æ–‡æ¡£](docs/Socket.IOäº‘æ‰˜ç®¡é›†æˆæŒ‡å—.md)
2. [å¿«é€Ÿå¼€å§‹](README-Socket.IOäº‘æ‰˜ç®¡.md)
3. æäº¤ Issue

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰**

---

**å®æ–½æ—¶é—´ï¼š** 2025-11-09  
**ç‰ˆæœ¬ï¼š** v1.0.0  
**çŠ¶æ€ï¼š** âœ… å®Œæˆ

