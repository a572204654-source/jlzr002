# ğŸš€ CloudBase äº‘æ‰˜ç®¡å°ç¨‹åºåç«¯ - åŠŸèƒ½æ€»è§ˆ

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

åŸºäº Express + MySQL çš„å¾®ä¿¡å°ç¨‹åºåç«¯æœåŠ¡æ¡†æ¶ï¼Œé€‚é…è…¾è®¯äº‘ CloudBase äº‘æ‰˜ç®¡éƒ¨ç½²ã€‚

---

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ… å¾®ä¿¡å°ç¨‹åºç™»å½•ï¼ˆwx.loginï¼‰
- âœ… JWT Token è®¤è¯
- âœ… ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- âœ… Token è‡ªåŠ¨ç»­æœŸ
- âœ… ç™»å½•çŠ¶æ€æ£€æŸ¥

**ç›¸å…³æ–‡ä»¶**:
- `routes/auth.js` - è®¤è¯è·¯ç”±
- `utils/jwt.js` - JWT å·¥å…·
- `utils/wechat.js` - å¾®ä¿¡ API
- `middleware/auth.js` - è®¤è¯ä¸­é—´ä»¶

---

### 2. å¤©æ°”æŸ¥è¯¢åŠŸèƒ½ ğŸŒ¤ï¸ âœ¨ **NEW**

#### åŠŸèƒ½ç‰¹ç‚¹
- âœ… **æ”¯æŒç”¨æˆ·å®šä½æŸ¥è¯¢**ï¼ˆç»çº¬åº¦ï¼‰
- âœ… **æ”¯æŒåŸå¸‚ ID æŸ¥è¯¢**
- âœ… JWT è®¤è¯å¯¹æ¥å’Œé£å¤©æ°”
- âœ… Token è‡ªåŠ¨ç”Ÿæˆå’Œç¼“å­˜
- âœ… å®æ—¶å¤©æ°”æŸ¥è¯¢
- âœ… 7å¤©/30å¤©å¤©æ°”é¢„æŠ¥
- âœ… é€å°æ—¶å¤©æ°”é¢„æŠ¥
- âœ… ç©ºæ°”è´¨é‡æŸ¥è¯¢ï¼ˆAQIã€PM2.5ï¼‰
- âœ… ç”Ÿæ´»æŒ‡æ•°æŸ¥è¯¢ï¼ˆç©¿è¡£ã€è¿åŠ¨ã€ç´«å¤–çº¿ç­‰ï¼‰
- âœ… å¤©æ°”é¢„è­¦ä¿¡æ¯
- âœ… ç»¼åˆå¤©æ°”ä¿¡æ¯ï¼ˆä¸€æ¬¡è·å–å…¨éƒ¨ï¼‰

#### API æ¥å£
```
GET /api/weather/now              - å®æ—¶å¤©æ°”
GET /api/weather/comprehensive    - ç»¼åˆå¤©æ°”ï¼ˆæ¨èï¼‰
GET /api/weather/daily            - å¤©æ°”é¢„æŠ¥
GET /api/weather/hourly           - é€å°æ—¶é¢„æŠ¥
GET /api/weather/air              - ç©ºæ°”è´¨é‡
GET /api/weather/indices          - ç”Ÿæ´»æŒ‡æ•°
GET /api/weather/warning          - å¤©æ°”é¢„è­¦
```

#### ä½¿ç”¨ç¤ºä¾‹
```javascript
// å°ç¨‹åºç«¯è·å–å®šä½å¹¶æŸ¥è¯¢å¤©æ°”
wx.getLocation({
  success: (res) => {
    wx.request({
      url: 'https://your-domain.com/api/weather/now',
      data: {
        location: `${res.longitude},${res.latitude}`
      },
      success: (res) => {
        console.log('å¤©æ°”:', res.data.data.data)
      }
    })
  }
})
```

**ç›¸å…³æ–‡ä»¶**:
- `routes/weather.js` - å¤©æ°”è·¯ç”±
- `utils/qweather.js` - å¤©æ°” API å·¥å…·
- `utils/qweather-jwt.js` - JWT Token ç”Ÿæˆ
- `config/index.js` - å’Œé£å¤©æ°”é…ç½®
- `ed25519-private.pem` - JWT ç§é’¥æ–‡ä»¶

**è¯¦ç»†æ–‡æ¡£**:
- [å¤©æ°”APIä½¿ç”¨æŒ‡å—.md](å¤©æ°”APIä½¿ç”¨æŒ‡å—.md)
- [å¤©æ°”åŠŸèƒ½å®Œæ•´æµç¨‹.md](å¤©æ°”åŠŸèƒ½å®Œæ•´æµç¨‹.md)
- [å’Œé£å¤©æ°”JWTé…ç½®å®Œæˆ.md](å’Œé£å¤©æ°”JWTé…ç½®å®Œæˆ.md)

---

### 3. è¯­éŸ³è¯†åˆ«åŠŸèƒ½ ğŸ¤

#### åŠŸèƒ½ç‰¹ç‚¹
- âœ… è…¾è®¯äº‘è¯­éŸ³è¯†åˆ«ï¼ˆASRï¼‰
- âœ… WebSocket å®æ—¶æµå¼è¯†åˆ«
- âœ… æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼
- âœ… è‡ªåŠ¨æ–­å¥å’Œæ ‡ç‚¹

#### API æ¥å£
```
POST /api/voice-recognition        - è¯­éŸ³è¯†åˆ«ï¼ˆæ—§ç‰ˆï¼‰
WS   /api/realtime-voice/recognize - å®æ—¶æµå¼è¯†åˆ«ï¼ˆæ–°ç‰ˆï¼‰
```

**ç›¸å…³æ–‡ä»¶**:
- `routes/voice-recognition.js` - è¯­éŸ³è¯†åˆ«è·¯ç”±ï¼ˆæ—§ç‰ˆï¼‰
- `routes/realtime-voice.js` - å®æ—¶è¯­éŸ³è¯†åˆ«è·¯ç”±ï¼ˆWebSocketï¼‰
- `utils/tencent-asr.js` - è…¾è®¯äº‘ ASR å·¥å…·

---

### 4. AI å¯¹è¯åŠŸèƒ½ ğŸ¤–

#### åŠŸèƒ½ç‰¹ç‚¹
- âœ… å¯¹æ¥ AI å¯¹è¯æœåŠ¡
- âœ… ä¸Šä¸‹æ–‡è®°å¿†
- âœ… æµå¼å“åº”
- âœ… å†å²è®°å½•ç®¡ç†

**ç›¸å…³æ–‡ä»¶**:
- `routes/ai-chat.js` - AI å¯¹è¯è·¯ç”±
- `routes/v1/ai-chat.js` - AI å¯¹è¯è·¯ç”± v1

---

### 5. å·¥ç¨‹ç®¡ç†åŠŸèƒ½ ğŸ—ï¸

#### åŠŸèƒ½æ¨¡å—
- âœ… é¡¹ç›®ç®¡ç†ï¼ˆCRUDï¼‰
- âœ… å·¥ä½œè®°å½•
- âœ… ç›‘ç†æ—¥å¿—
- âœ… é™„ä»¶ä¸Šä¼ 
- âœ… æƒé™æ§åˆ¶

**ç›¸å…³æ–‡ä»¶**:
- `routes/project.js` - é¡¹ç›®ç®¡ç†
- `routes/work.js` - å·¥ä½œè®°å½•
- `routes/supervision-log.js` - ç›‘ç†æ—¥å¿—
- `routes/attachment.js` - é™„ä»¶ç®¡ç†

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ bin/                      # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ database.js          # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ index.js             # ç»Ÿä¸€é…ç½®å…¥å£
â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth.js              # è®¤è¯ä¸­é—´ä»¶
â”‚   â””â”€â”€ errorHandler.js      # é”™è¯¯å¤„ç†
â”œâ”€â”€ routes/                   # è·¯ç”±æ–‡ä»¶
â”‚   â”œâ”€â”€ auth.js              # è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ weather.js           # å¤©æ°”è·¯ç”± âœ¨
â”‚   â”œâ”€â”€ voice-recognition.js # è¯­éŸ³è¯†åˆ«
â”‚   â”œâ”€â”€ ai-chat.js           # AI å¯¹è¯
â”‚   â””â”€â”€ ...                  # å…¶ä»–è·¯ç”±
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ jwt.js               # JWT å·¥å…·
â”‚   â”œâ”€â”€ wechat.js            # å¾®ä¿¡ API
â”‚   â”œâ”€â”€ qweather.js          # å¤©æ°” API âœ¨
â”‚   â”œâ”€â”€ qweather-jwt.js      # å¤©æ°” JWT âœ¨
â”‚   â”œâ”€â”€ tencent-asr.js       # è¯­éŸ³è¯†åˆ«
â”‚   â””â”€â”€ response.js          # ç»Ÿä¸€å“åº”
â”œâ”€â”€ scripts/                  # è„šæœ¬æ–‡ä»¶
â”‚   â””â”€â”€ init-db.sql          # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ docs/                     # æ–‡æ¡£
â”‚   â”œâ”€â”€ å¤©æ°”APIä½¿ç”¨æŒ‡å—.md    # å¤©æ°”æ–‡æ¡£ âœ¨
â”‚   â”œâ”€â”€ å¤©æ°”åŠŸèƒ½å®Œæ•´æµç¨‹.md   # æµç¨‹å›¾ âœ¨
â”‚   â””â”€â”€ ...                  # å…¶ä»–æ–‡æ¡£
â”œâ”€â”€ miniapp-example/         # å°ç¨‹åºç¤ºä¾‹
â”‚   â””â”€â”€ weather-with-location.js  # å¤©æ°”ç¤ºä¾‹ âœ¨
â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”œâ”€â”€ views/                   # è§†å›¾æ¨¡æ¿
â”œâ”€â”€ .env                     # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .gitignore              # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ app.js                  # åº”ç”¨å…¥å£
â”œâ”€â”€ package.json            # ä¾èµ–ç®¡ç†
â”œâ”€â”€ Dockerfile              # Docker é…ç½®
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- **Node.js** - v14+
- **Express.js** - v4.x
- **express-ws** - WebSocket æ”¯æŒ

### æ•°æ®åº“
- **MySQL** - v5.7+
- **mysql2** - MySQL å®¢æˆ·ç«¯

### è®¤è¯å’Œå®‰å…¨
- **jsonwebtoken** - JWT è®¤è¯
- **jose** - Ed25519 JWT ç­¾åï¼ˆå¤©æ°” APIï¼‰
- **bcrypt** - å¯†ç åŠ å¯†

### ç¬¬ä¸‰æ–¹æœåŠ¡
- **å’Œé£å¤©æ°” API** - å¤©æ°”æ•°æ® âœ¨
- **è…¾è®¯äº‘ ASR** - è¯­éŸ³è¯†åˆ«
- **å¾®ä¿¡å°ç¨‹åº API** - ç”¨æˆ·ç™»å½•

### å·¥å…·åº“
- **axios** - HTTP å®¢æˆ·ç«¯
- **dotenv** - ç¯å¢ƒå˜é‡ç®¡ç†
- **cors** - è·¨åŸŸæ”¯æŒ
- **morgan** - æ—¥å¿—è®°å½•

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=your_database

# å¾®ä¿¡å°ç¨‹åºé…ç½®
WECHAT_APPID=your_appid
WECHAT_APPSECRET=your_appsecret

# JWT é…ç½®
JWT_SECRET=your_jwt_secret

# å’Œé£å¤©æ°”é…ç½® âœ¨
QWEATHER_KEY_ID=TCWHA45GD4
QWEATHER_PROJECT_ID=288AH4E373
QWEATHER_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n
QWEATHER_API_HOST=https://ma4bjadbw4.re.qweatherapi.com

# è…¾è®¯äº‘é…ç½®
TENCENT_SECRET_ID=your_secret_id
TENCENT_SECRET_KEY=your_secret_key
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` åˆ° `.env` å¹¶å¡«å†™é…ç½®

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
mysql -u root -p < scripts/init-db.sql
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§ç¯å¢ƒ
npm start
```

### 5. æµ‹è¯•æ¥å£

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost/health

# æµ‹è¯•å¤©æ°”æ¥å£ âœ¨
curl "http://localhost/api/weather/now?location=116.41,39.92"

# æˆ–ä½¿ç”¨æµ‹è¯•è„šæœ¬
node test-qweather-simple.js
```

---

## ğŸ“¡ API ç»Ÿä¸€å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "code": 0,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { },
  "timestamp": 1699200000000
}
```

### é”™è¯¯å“åº”

```json
{
  "code": 400,
  "message": "å‚æ•°é”™è¯¯",
  "timestamp": 1699200000000
}
```

### é”™è¯¯ç è¯´æ˜

| Code | è¯´æ˜ |
|------|------|
| 0 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒï¼ˆæœªç™»å½•ï¼‰ |
| 403 | æ— æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
npm test
```

### æ¥å£æµ‹è¯•

ä½¿ç”¨ Postman æˆ– curl æµ‹è¯•æ¥å£

**å¤©æ°”æ¥å£æµ‹è¯•ç¤ºä¾‹** âœ¨:
```bash
# å®æ—¶å¤©æ°”
curl "http://localhost/api/weather/now?location=116.41,39.92"

# ç»¼åˆå¤©æ°”
curl "http://localhost/api/weather/comprehensive?location=116.41,39.92"
```

è¯¦è§: [å¤©æ°”APIæµ‹è¯•ç¤ºä¾‹.md](å¤©æ°”APIæµ‹è¯•ç¤ºä¾‹.md)

---

## ğŸ“¦ éƒ¨ç½²

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t miniapp-backend .

# è¿è¡Œå®¹å™¨
docker run -p 80:80 --env-file .env miniapp-backend
```

### äº‘æ‰˜ç®¡éƒ¨ç½²

1. æ¨é€ä»£ç åˆ°ä»£ç ä»“åº“
2. åœ¨è…¾è®¯äº‘ CloudBase æ§åˆ¶å°åˆ›å»ºäº‘æ‰˜ç®¡æœåŠ¡
3. é…ç½®ç¯å¢ƒå˜é‡
4. éƒ¨ç½²æœåŠ¡

**æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®å†…ç½‘æ•°æ®åº“åœ°å€

---

## ğŸ“– æ–‡æ¡£ç´¢å¼•

### æ ¸å¿ƒæ–‡æ¡£
- [API.md](../API.md) - å®Œæ•´ API æ–‡æ¡£
- [Cursor Rules](.cursorules) - ç¼–ç è§„èŒƒ

### å¤©æ°”åŠŸèƒ½æ–‡æ¡£ âœ¨
- [README-å¤©æ°”åŠŸèƒ½.md](../README-å¤©æ°”åŠŸèƒ½.md) - å¿«é€Ÿå‚è€ƒ
- [å¤©æ°”APIä½¿ç”¨æŒ‡å—.md](å¤©æ°”APIä½¿ç”¨æŒ‡å—.md) - è¯¦ç»†è¯´æ˜
- [å¤©æ°”åŠŸèƒ½å®Œæ•´æµç¨‹.md](å¤©æ°”åŠŸèƒ½å®Œæ•´æµç¨‹.md) - æµç¨‹å›¾
- [å¤©æ°”APIæµ‹è¯•ç¤ºä¾‹.md](å¤©æ°”APIæµ‹è¯•ç¤ºä¾‹.md) - æµ‹è¯•æ–¹æ³•
- [å’Œé£å¤©æ°”JWTé…ç½®å®Œæˆ.md](å’Œé£å¤©æ°”JWTé…ç½®å®Œæˆ.md) - é…ç½®è¯´æ˜

### ç¤ºä¾‹ä»£ç 
- [miniapp-example/](../miniapp-example/) - å°ç¨‹åºç¤ºä¾‹ä»£ç 
  - `weather-with-location.js` - å¤©æ°”æŸ¥è¯¢ç¤ºä¾‹ âœ¨

---

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**
   - ä¸è¦æäº¤ `.env` æ–‡ä»¶
   - ä¸è¦æäº¤ç§é’¥æ–‡ä»¶ï¼ˆ`*.pem`ï¼‰
   - JWT_SECRET ä½¿ç”¨å¼ºå¯†ç 

2. **æ•°æ®åº“å®‰å…¨**
   - ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å†…ç½‘åœ°å€
   - å®šæœŸå¤‡ä»½æ•°æ®

3. **API å®‰å…¨**
   - æ¥å£æ·»åŠ è®¤è¯ä¸­é—´ä»¶
   - éªŒè¯ç”¨æˆ·æƒé™
   - æ·»åŠ æ¥å£é™æµ

4. **Token ç®¡ç†**
   - JWT Token è®¾ç½®åˆç†è¿‡æœŸæ—¶é—´
   - å¤©æ°” JWT Token è‡ªåŠ¨ç¼“å­˜å’Œåˆ·æ–°
   - æ•æ„Ÿæ“ä½œéªŒè¯ Token

---

## ğŸ¯ è·¯çº¿å›¾

### å·²å®Œæˆ âœ…
- [x] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [x] å¤©æ°”æŸ¥è¯¢åŠŸèƒ½ âœ¨
- [x] è¯­éŸ³è¯†åˆ«åŠŸèƒ½
- [x] AI å¯¹è¯åŠŸèƒ½
- [x] å·¥ç¨‹ç®¡ç†åŠŸèƒ½
- [x] JWT è®¤è¯
- [x] WebSocket æ”¯æŒ
- [x] Docker éƒ¨ç½²

### è®¡åˆ’ä¸­ ğŸ“‹
- [ ] æ–‡ä»¶ä¸Šä¼ ï¼ˆè…¾è®¯äº‘ COSï¼‰
- [ ] æ¶ˆæ¯æ¨é€ï¼ˆå¾®ä¿¡è®¢é˜…æ¶ˆæ¯ï¼‰
- [ ] æ”¯ä»˜åŠŸèƒ½ï¼ˆå¾®ä¿¡æ”¯ä»˜ï¼‰
- [ ] Redis ç¼“å­˜
- [ ] API æ–‡æ¡£ï¼ˆSwaggerï¼‰
- [ ] å•å…ƒæµ‹è¯•å®Œå–„
- [ ] æ€§èƒ½ç›‘æ§

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'æ–°å¢: æŸæŸåŠŸèƒ½'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

---

## ğŸ“„ å¼€æºåè®®

MIT License

---

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›® Issues: [æäº¤é—®é¢˜]
- æŠ€æœ¯æ”¯æŒ: [è”ç³»æ–¹å¼]

---

## ğŸ‰ æ›´æ–°æ—¥å¿—

### v1.1.0 (2025-11-08) âœ¨
- âœ… æ–°å¢å¤©æ°”æŸ¥è¯¢åŠŸèƒ½
- âœ… é›†æˆå’Œé£å¤©æ°” API
- âœ… æ”¯æŒç”¨æˆ·å®šä½æŸ¥è¯¢å¤©æ°”
- âœ… å®ç° JWT è®¤è¯å¯¹æ¥
- âœ… å®Œå–„æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 

### v1.0.0 (2024-11-06)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ… è¯­éŸ³è¯†åˆ«åŠŸèƒ½
- âœ… AI å¯¹è¯åŠŸèƒ½
- âœ… å·¥ç¨‹ç®¡ç†åŠŸèƒ½

---

**æœ€åæ›´æ–°**: 2025-11-08  
**å½“å‰ç‰ˆæœ¬**: v1.1.0

ğŸŠ CloudBase äº‘æ‰˜ç®¡å°ç¨‹åºåç«¯æœåŠ¡æ¡†æ¶ - å¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆï¼




