<view class="container">
  <view class="header">
    <text class="title">实时语音识别</text>
    <text class="subtitle">（微信云托管 Socket.IO 版本）</text>
    <view class="status {{isConnected ? 'connected' : 'disconnected'}}">
      {{isConnected ? '● 已连接' : '○ 未连接'}}
    </view>
  </view>

  <!-- 统计信息 -->
  <view class="stats">
    <view class="stat-item">
      <text class="stat-value">{{stats.totalCount}}</text>
      <text class="stat-label">总次数</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{stats.todayCount}}</text>
      <text class="stat-label">今日</text>
    </view>
  </view>

  <!-- 识别结果显示区 -->
  <view class="result-container">
    <view class="result-header">
      <text>识别结果</text>
      <view class="result-actions">
        <button class="action-btn" size="mini" bindtap="copyText">复制</button>
        <button class="action-btn" size="mini" bindtap="clearText">清空</button>
      </view>
    </view>
    <view class="result-content">
      <text wx:if="{{recognizedText}}" class="result-text">{{recognizedText}}</text>
      <text wx:else class="result-placeholder">暂无识别结果</text>
    </view>
    <view class="current-text" wx:if="{{currentText && currentText !== recognizedText}}">
      <text class="current-label">识别中：</text>
      <text>{{currentText}}</text>
    </view>
  </view>

  <!-- 录音按钮 -->
  <view class="record-container">
    <view class="status-text">{{statusText}}</view>
    <button 
      class="record-btn {{isRecording ? 'recording' : ''}}" 
      bindtouchstart="startRecording"
      bindtouchend="stopRecording"
      bindtouchcancel="stopRecording"
    >
      <text wx:if="{{isRecording}}">松开结束</text>
      <text wx:else>按住说话</text>
    </button>
  </view>

  <!-- 操作按钮 -->
  <view class="action-bar">
    <button class="action-button" bindtap="applyToLog">应用到监理日志</button>
  </view>

  <!-- 历史记录 -->
  <view class="history-container" wx:if="{{histories.length > 0}}">
    <view class="history-header">
      <text>最近记录</text>
    </view>
    <view class="history-list">
      <view 
        class="history-item" 
        wx:for="{{histories}}" 
        wx:key="id"
        data-item="{{item}}"
        bindtap="viewHistory"
      >
        <view class="history-text">{{item.recognizedText}}</view>
        <view class="history-meta">
          <text class="history-time">{{item.createdAt}}</text>
          <button 
            class="history-delete" 
            size="mini" 
            data-id="{{item.id}}"
            bindtap="deleteHistory"
            catchtap="deleteHistory"
          >
            删除
          </button>
        </view>
      </view>
    </view>
  </view>
</view>

