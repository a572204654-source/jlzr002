# éƒ¨ç½²æŒ‡å—

## ğŸ“‹ å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
- ä»£ç å·²ä¿®æ”¹å¹¶æäº¤åˆ° Git ä»“åº“
- å¤©æ°”è¿”å›æ ¼å¼å·²æ›´æ–°ä¸ºï¼š`å¤©æ°” X Â· æ°”æ¸©: X-X Â· é£å‘: X Â· é£åŠ›: X`

### âš ï¸ å¾…å®Œæˆ
- **éœ€è¦å°†æ–°ä»£ç éƒ¨ç½²åˆ°çº¿ä¸ŠæœåŠ¡å™¨**

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹å¼ä¸€ï¼šè…¾è®¯äº‘ CloudBase äº‘æ‰˜ç®¡è‡ªåŠ¨éƒ¨ç½²

å¦‚æœä½ çš„é¡¹ç›®é…ç½®äº†è‡ªåŠ¨éƒ¨ç½²ï¼Œåªéœ€ï¼š

1. **æ¨é€ä»£ç åˆ° Git ä»“åº“**ï¼ˆå·²å®Œæˆ âœ…ï¼‰
   ```bash
   git push origin main
   ```

2. **ç­‰å¾…äº‘æ‰˜ç®¡è‡ªåŠ¨æ„å»ºéƒ¨ç½²**
   - ç™»å½• [è…¾è®¯äº‘ CloudBase æ§åˆ¶å°](https://console.cloud.tencent.com/tcb)
   - è¿›å…¥ä½ çš„ç¯å¢ƒ â†’ äº‘æ‰˜ç®¡
   - æŸ¥çœ‹æœåŠ¡éƒ¨ç½²çŠ¶æ€
   - ç­‰å¾…æ„å»ºå®Œæˆï¼ˆé€šå¸¸éœ€è¦ 3-5 åˆ†é’Ÿï¼‰

3. **éªŒè¯éƒ¨ç½²**
   ```bash
   # è®¿é—®çº¿ä¸Šæ¥å£æµ‹è¯•
   https://api.yimengpl.com/api/weather/current?latitude=39.92&longitude=116.41
   ```

---

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆDockerï¼‰

å¦‚æœéœ€è¦æ‰‹åŠ¨éƒ¨ç½²ï¼š

#### 1. ç™»å½•æœåŠ¡å™¨
```bash
ssh user@your-server-ip
```

#### 2. è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd /path/to/your/project
```

#### 3. æ‹‰å–æœ€æ–°ä»£ç 
```bash
git pull origin main
```

#### 4. é‡æ–°æ„å»º Docker é•œåƒ
```bash
docker build -t cloudrun-express:latest .
```

#### 5. åœæ­¢æ—§å®¹å™¨
```bash
docker stop cloudrun-express
docker rm cloudrun-express
```

#### 6. å¯åŠ¨æ–°å®¹å™¨
```bash
docker run -d \
  --name cloudrun-express \
  -p 80:80 \
  -e DB_HOST=your-db-host \
  -e DB_PORT=3306 \
  -e DB_USER=your-db-user \
  -e DB_PASSWORD=your-db-password \
  -e DB_NAME=your-db-name \
  -e WECHAT_APPID=your-appid \
  -e WECHAT_APPSECRET=your-appsecret \
  -e JWT_SECRET=your-jwt-secret \
  -e QWEATHER_API_KEY=your-qweather-key \
  cloudrun-express:latest
```

#### 7. éªŒè¯éƒ¨ç½²
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs -f cloudrun-express

# æµ‹è¯•æ¥å£
curl "http://localhost/api/weather/current?latitude=39.92&longitude=116.41"
```

---

### æ–¹å¼ä¸‰ï¼šç›´æ¥é‡å¯ Node.js æœåŠ¡ï¼ˆé Dockerï¼‰

å¦‚æœä½ æ˜¯ç›´æ¥è¿è¡Œ Node.jsï¼š

#### 1. ç™»å½•æœåŠ¡å™¨å¹¶æ‹‰å–ä»£ç 
```bash
ssh user@your-server-ip
cd /path/to/your/project
git pull origin main
```

#### 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæœ‰æ–°ä¾èµ–ï¼‰
```bash
npm install
```

#### 3. é‡å¯æœåŠ¡
```bash
# å¦‚æœä½¿ç”¨ PM2
pm2 restart app

# æˆ–è€…ç›´æ¥é‡å¯
pm2 restart all

# æŸ¥çœ‹æ—¥å¿—
pm2 logs
```

---

## âœ… éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥æ¥å£è¿”å›æ ¼å¼

è®¿é—®ï¼š
```
https://api.yimengpl.com/api/weather/current?latitude=39.92&longitude=116.41
```

**æœŸæœ›è¿”å›**ï¼ˆæ–°æ ¼å¼ï¼‰ï¼š
```json
{
  "code": 0,
  "message": "è·å–æ°”è±¡ä¿¡æ¯æˆåŠŸ",
  "data": {
    "weather": "å¤©æ°” é›¾ Â· æ°”æ¸©: 7-13 Â· é£å‘: å—é£ Â· é£åŠ›: 1",
    "weatherText": "é›¾",
    "temperature": 7,
    "temperatureMin": 7,
    "temperatureMax": 13,
    "humidity": 96,
    "windDirection": "å—é£",
    "windScale": "1",
    "updateTime": "2025-11-08T22:34+08:00"
  },
  "timestamp": 1762612962806
}
```

**æ—§æ ¼å¼**ï¼ˆéœ€è¦æ›´æ–°ï¼‰ï¼š
```json
{
  "weather": "é›¾ï¼Œ7-13â„ƒ"  // âŒ å¦‚æœçœ‹åˆ°è¿™ä¸ªæ ¼å¼ï¼Œè¯´æ˜è¿˜æ²¡éƒ¨ç½²æˆåŠŸ
}
```

### 2. æ£€æŸ¥å¥åº·çŠ¶æ€
```bash
curl https://api.yimengpl.com/health
```

### 3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—
- äº‘æ‰˜ç®¡ï¼šåœ¨æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—
- Dockerï¼š`docker logs cloudrun-express`
- PM2ï¼š`pm2 logs`

---

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šéƒ¨ç½²åè¿˜æ˜¯æ—§æ ¼å¼

**åŸå› **ï¼š
- ä»£ç æ²¡æœ‰æ­£ç¡®æ‹‰å–
- æœåŠ¡æ²¡æœ‰é‡å¯
- ç¼“å­˜é—®é¢˜

**è§£å†³**ï¼š
```bash
# 1. ç¡®è®¤ä»£ç ç‰ˆæœ¬
git log --oneline -5

# 2. å¼ºåˆ¶é‡å¯æœåŠ¡
docker restart cloudrun-express
# æˆ–
pm2 restart app --update-env

# 3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜é‡æ–°æµ‹è¯•
```

### é—®é¢˜2ï¼šéƒ¨ç½²å¤±è´¥

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹æ„å»ºæ—¥å¿—
2. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
4. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸

### é—®é¢˜3ï¼šæ¥å£è¿”å› 500 é”™è¯¯

**æ£€æŸ¥**ï¼š
- æ•°æ®åº“è¿æ¥é…ç½®
- å’Œé£å¤©æ°” API Key é…ç½®
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—å®šä½å…·ä½“é”™è¯¯

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ï¼š

- [ ] ä»£ç å·²æ¨é€åˆ° Git ä»“åº“
- [ ] ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] å’Œé£å¤©æ°” API Key å·²é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] æœåŠ¡å·²é‡å¯
- [ ] æ¥å£è¿”å›æ–°æ ¼å¼
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸è°ƒç”¨

---

## ğŸ¯ å¿«é€ŸéªŒè¯å‘½ä»¤

```bash
# æµ‹è¯•åŒ—äº¬å¤©æ°”
curl "https://api.yimengpl.com/api/weather/current?latitude=39.92&longitude=116.41" \
  -H "Authorization: Bearer YOUR_TOKEN"

# æœŸæœ›çœ‹åˆ°ï¼š
# "weather": "å¤©æ°” é›¾ Â· æ°”æ¸©: 7-13 Â· é£å‘: å—é£ Â· é£åŠ›: 1"
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœéƒ¨ç½²é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—
2. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
3. ç¡®è®¤ç½‘ç»œå’Œæ•°æ®åº“è¿æ¥
4. æŸ¥çœ‹ Git æäº¤è®°å½•ç¡®è®¤ä»£ç ç‰ˆæœ¬

---

**æœ€åæ›´æ–°**: 2024-11-08
**å½“å‰ç‰ˆæœ¬**: v1.1.0

